<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Incus – Notes, Procedures, and Best Practices // rowstu.net</title><link rel=stylesheet href=/assets/shared-theme.css><style>.markdown-content{max-width:900px;margin:0 auto;line-height:1.7}.markdown-content h1{font-size:2.5rem;margin-bottom:1rem;color:var(--accent-teal);border-bottom:2px solid var(--border);padding-bottom:.5rem}.markdown-content h2{font-size:2rem;margin-top:2rem;margin-bottom:1rem;color:var(--accent-orange)}.markdown-content h3{font-size:1.5rem;margin-top:1.5rem;margin-bottom:.75rem;color:var(--text-primary)}.markdown-content p{margin-bottom:1rem}.markdown-content code{background:var(--bg-light);padding:.2rem .4rem;border-radius:3px;font-family:jetbrains mono,monospace;font-size:.9em}.markdown-content pre{background:var(--bg-light);padding:1rem;border-radius:6px;overflow-x:auto;margin-bottom:1rem}.markdown-content pre code{background:0 0;padding:0}.markdown-content a{color:var(--accent-teal);text-decoration:none}.markdown-content a:hover{text-decoration:underline}.markdown-content ul,.markdown-content ol{margin-bottom:1rem;padding-left:2rem}.markdown-content li{margin-bottom:.5rem}.markdown-content blockquote{border-left:4px solid var(--accent-teal);padding-left:1rem;margin:1rem 0;color:var(--text-secondary);font-style:italic}.markdown-content table{width:100%;border-collapse:collapse;margin-bottom:1rem}.markdown-content th,.markdown-content td{border:1px solid var(--border);padding:.75rem;text-align:left}.markdown-content th{background:var(--bg-light);font-weight:600}.breadcrumb{padding:1rem 0;color:var(--text-secondary);font-size:.95rem}.breadcrumb a{color:var(--accent-teal);text-decoration:none}.breadcrumb a:hover{text-decoration:underline}</style></head><body><div class=app-header><h1 class=app-title>Incus – Notes, Procedures, and Best Practices</h1></div><div class=container><div class=breadcrumb><a href=/>Home</a> / <a href=/browse/>Browse</a>/ <a href=/incusnotes/>Incusnotes</a></div><div class="card markdown-content"><p><strong>LXC (Linux Containers)</strong> is a low-level container technology that provides:</p><ul><li><p>OS-level virtualization using <strong>kernel features</strong>:</p><ul><li>namespaces (pid, net, mount, user, ipc, uts)</li><li>cgroups (resource control)</li><li>seccomp, AppArmor/SELinux</li></ul></li><li><p>Containers that behave like <strong>lightweight virtual machines</strong></p><ul><li>Full init system</li><li>Multiple services</li><li>Persistent state</li></ul></li></ul><p><strong>Key characteristics</strong></p><ul><li>Near-native performance</li><li>Uses the host kernel</li><li>Designed for <em>system containers</em>, not single-process workloads</li></ul><h3 id=what-is-incus>What is Incus?</h3><p><strong>Incus</strong> is a <strong>modern container and VM manager</strong> built on top of:</p><ul><li>LXC (for system containers)</li><li>QEMU/KVM (for virtual machines)</li></ul><p>Incus is a <strong>community-driven continuation of LXD</strong>, created to ensure:</p><ul><li>Open governance</li><li>No forced cloud/SaaS integration</li><li>Clean separation from Canonical’s Snap ecosystem</li></ul><p><strong>Incus provides</strong></p><ul><li>REST API</li><li>CLI (<code>incus</code>)</li><li>Image management</li><li>Networking (bridges, OVN, macvlan)</li><li>Storage backends (ZFS, Btrfs, LVM, Ceph)</li><li>Profiles and projects</li><li>Clustering support</li></ul><p><strong>Use Incus when</strong></p><ul><li>You want VM-like isolation without VM overhead</li><li>You manage servers, labs, or homelabs</li><li>You need long-running services</li><li>You want containers you can SSH into and treat like hosts</li></ul><hr><h2 id=installation-and-configuration>Installation and Configuration</h2><h2 id=ubuntu-2204-recommended>Ubuntu (22.04+ recommended)</h2><h3 id=install-incus>Install Incus</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install incus
</span></span></code></pre></div><p>Ensure your user can manage Incus:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG incus $USER
</span></span><span style=display:flex><span>newgrp incus
</span></span></code></pre></div><h3 id=initialize-incus>Initialize Incus</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus admin init
</span></span></code></pre></div><p><strong>Typical answers</strong></p><ul><li>Storage backend: <code>zfs</code> (recommended)</li><li>Network bridge: <code>incusbr0</code></li><li>IPv4: <code>auto</code></li><li>IPv6: <code>auto</code> (disable if you don’t use it)</li><li>Clustering: <code>no</code> (unless needed)</li></ul><h3 id=verify>Verify</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus info
</span></span><span style=display:flex><span>incus list
</span></span></code></pre></div><hr><h2 id=arch-linux>Arch Linux</h2><h3 id=install-packages>Install packages</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -S incus lxc lxcfs
</span></span></code></pre></div><h3 id=enable-services>Enable services</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable --now incus
</span></span><span style=display:flex><span>sudo systemctl enable --now lxcfs
</span></span></code></pre></div><h3 id=add-user-to-incus-group>Add user to incus group</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG incus $USER
</span></span><span style=display:flex><span>newgrp incus
</span></span></code></pre></div><h3 id=initialize>Initialize</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus admin init
</span></span></code></pre></div><hr><h2 id=configuration-tips-performance--security>Configuration Tips (Performance & Security)</h2><h3 id=kernel-tuning>Kernel tuning</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl -w vm.swappiness<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>sysctl -w fs.inotify.max_user_instances<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span>
</span></span></code></pre></div><h3 id=apparmor>AppArmor</h3><p>Ensure AppArmor is enabled:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aa-status
</span></span></code></pre></div><p>Incus relies heavily on AppArmor for container confinement.</p><h3 id=storage-backend-choice>Storage backend choice</h3><ul><li><strong>ZFS</strong> – best all-round (snapshots, performance)</li><li><strong>Btrfs</strong> – good alternative</li><li><strong>LVM</strong> – solid but fewer features</li><li><strong>dir</strong> – only for testing</li></ul><hr><h2 id=creating-and-managing-containers>Creating and Managing Containers</h2><h3 id=list-available-images>List available images</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus image list images:
</span></span></code></pre></div><h3 id=create-a-container>Create a container</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus launch images:ubuntu/22.04 mycontainer
</span></span></code></pre></div><h3 id=container-lifecycle>Container lifecycle</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus start mycontainer
</span></span><span style=display:flex><span>incus stop mycontainer
</span></span><span style=display:flex><span>incus restart mycontainer
</span></span><span style=display:flex><span>incus delete mycontainer
</span></span></code></pre></div><h3 id=execute-commands>Execute commands</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus exec mycontainer -- bash
</span></span></code></pre></div><h3 id=file-transfer>File transfer</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus file push local.txt mycontainer/root/
</span></span><span style=display:flex><span>incus file pull mycontainer/etc/os-release .
</span></span></code></pre></div><hr><h2 id=networking-configuration>Networking Configuration</h2><h3 id=default-bridge>Default bridge</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus network list
</span></span><span style=display:flex><span>incus network show incusbr0
</span></span></code></pre></div><h3 id=assign-static-ip>Assign static IP</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus config device set mycontainer eth0 ipv4.address 10.0.0.50
</span></span></code></pre></div><h3 id=port-forwarding>Port forwarding</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus config device add mycontainer http proxy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  listen<span style=color:#f92672>=</span>tcp:0.0.0.0:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  connect<span style=color:#f92672>=</span>tcp:127.0.0.1:80
</span></span></code></pre></div><hr><h2 id=storage-configuration>Storage Configuration</h2><h3 id=list-storage-pools>List storage pools</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus storage list
</span></span></code></pre></div><h3 id=attach-extra-disk>Attach extra disk</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus storage volume create default data-vol
</span></span><span style=display:flex><span>incus storage volume attach default data-vol mycontainer /mnt/data
</span></span></code></pre></div><hr><h2 id=resource-limits>Resource Limits</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus config set mycontainer limits.cpu <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>incus config set mycontainer limits.memory 2GiB
</span></span><span style=display:flex><span>incus config set mycontainer limits.disk.priority <span style=color:#ae81ff>5</span>
</span></span></code></pre></div><hr><h2 id=best-practices>Best Practices</h2><h2 id=security-best-practices>Security Best Practices</h2><h3 id=use-unprivileged-containers-default>Use unprivileged containers (default)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus config show mycontainer | grep security.privileged
</span></span></code></pre></div><p>Should be <code>false</code>.</p><h3 id=enable-user-namespaces>Enable user namespaces</h3><p>Avoid:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>security.privileged<span style=color:#f92672>=</span>true
</span></span></code></pre></div><p>Unless you <em>really</em> know why you need it.</p><h3 id=limit-capabilities>Limit capabilities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus config set mycontainer security.capabilities.drop<span style=color:#f92672>=</span>all
</span></span></code></pre></div><h3 id=use-profiles-instead-of-per-container-config>Use profiles instead of per-container config</h3><p>Profiles reduce drift and mistakes.</p><hr><h2 id=backup-and-recovery>Backup and Recovery</h2><h3 id=snapshot-a-container>Snapshot a container</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus snapshot mycontainer snap1
</span></span></code></pre></div><h3 id=restore>Restore</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus restore mycontainer snap1
</span></span></code></pre></div><h3 id=export-container>Export container</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus export mycontainer mycontainer.tar.gz
</span></span></code></pre></div><h3 id=import>Import</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus import mycontainer.tar.gz
</span></span></code></pre></div><h3 id=automate-backups>Automate backups</h3><ul><li>ZFS snapshots + replication</li><li><code>incus export</code> via cron</li><li>External storage pool replication</li></ul><hr><h2 id=troubleshooting-and-performance-monitoring>Troubleshooting and Performance Monitoring</h2><h2 id=common-issues>Common Issues</h2><h3 id=container-wont-start>Container won’t start</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus info --show-log mycontainer
</span></span></code></pre></div><h3 id=network-issues>Network issues</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus exec mycontainer -- ip a
</span></span><span style=display:flex><span>incus network show incusbr0
</span></span></code></pre></div><h3 id=permission-problems>Permission problems</h3><ul><li>Check AppArmor denials:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dmesg | grep DENIED
</span></span></code></pre></div><hr><h2 id=performance-monitoring>Performance Monitoring</h2><h3 id=built-in-metrics>Built-in metrics</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus info mycontainer
</span></span></code></pre></div><h3 id=host-tools>Host tools</h3><ul><li><code>htop</code></li><li><code>iotop</code></li><li><code>nstat</code></li><li><code>bpftop</code></li></ul><h3 id=cgroup-inspection>cgroup inspection</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /sys/fs/cgroup/system.slice/incus-container.scope/*
</span></span></code></pre></div><hr><h2 id=advanced-topics>Advanced Topics</h2><h2 id=profiles-very-important>Profiles (Very Important)</h2><p>Profiles define reusable configuration.</p><h3 id=list-profiles>List profiles</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus profile list
</span></span></code></pre></div><h3 id=create-profile>Create profile</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus profile create web
</span></span><span style=display:flex><span>incus profile edit web
</span></span></code></pre></div><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits.cpu</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits.memory</span>: <span style=color:#ae81ff>2GiB</span>
</span></span><span style=display:flex><span><span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>eth0</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>nic</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>network</span>: <span style=color:#ae81ff>incusbr0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>root</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>disk</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pool</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span></code></pre></div><h3 id=apply-profile>Apply profile</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus launch images:ubuntu/22.04 web01 --profile web
</span></span></code></pre></div><hr><h2 id=orchestrating-multiple-containers>Orchestrating Multiple Containers</h2><p>Incus is <strong>not Kubernetes</strong>, and that’s a feature.</p><p>Common patterns:</p><ul><li>One service per container</li><li>Reverse proxy container (nginx/traefik)</li><li>Dedicated DB containers</li><li>Profiles + naming conventions</li></ul><p>For higher-level orchestration:</p><ul><li>Ansible (excellent fit)</li><li>Terraform (Incus provider)</li><li>Incus clustering for HA</li></ul><hr><h2 id=clustering-brief>Clustering (Brief)</h2><ul><li>Shared storage (Ceph or replicated ZFS)</li><li>Distributed database</li><li>Containers can migrate live</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>incus cluster add node2
</span></span></code></pre></div></div></div><script src=/assets/shared-nav.js></script></body></html>