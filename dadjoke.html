<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dad Jokes</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg: #1a1d23;
			--surface: #252932;
			--surface-hover: #2d323d;
			--border: #3d4351;
			--text: #e4e7eb;
			--text-muted: #9ca3af;
			--accent: #10b981;
			--accent-alt: #8b5cf6;
			--warning: #f59e0b;
			--danger: #ef4444;
		}

		* { margin: 0; padding: 0; box-sizing: border-box; }

		body {
			font-family: 'IBM Plex Mono', monospace;
			background: var(--bg);
			color: var(--text);
			min-height: 100vh;
			padding: 1.5rem;
		}

		.container { max-width: 700px; margin: 0 auto; }

		header { margin-bottom: 1.5rem; }

		h1 {
			font-size: 1.5rem;
			font-weight: 600;
			color: var(--accent);
			margin-bottom: 0.5rem;
		}

		.subtitle { color: var(--text-muted); font-size: 0.875rem; }

		.panel {
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 6px;
			margin-bottom: 1rem;
			overflow: hidden;
		}

		.panel-header {
			padding: 0.75rem 1rem;
			border-bottom: 1px solid var(--border);
			font-size: 0.8rem;
			color: var(--text-muted);
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.panel-header .label { font-weight: 500; color: var(--text); }

		.panel-content { padding: 2rem; text-align: center; }

		.joke-container {
			min-height: 200px;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}

		.joke-setup {
			font-size: 1.3rem;
			line-height: 1.6;
			color: var(--text);
			margin-bottom: 1.5rem;
		}

		.joke-punchline {
			font-size: 1.1rem;
			color: var(--warning);
			font-weight: 500;
			opacity: 0;
			transform: translateY(10px);
			transition: all 0.3s ease;
			cursor: pointer;
		}

		.joke-punchline.revealed {
			opacity: 1;
			transform: translateY(0);
		}

		.joke-punchline.hidden {
			background: var(--surface-hover);
			border: 1px dashed var(--border);
			border-radius: 6px;
			padding: 0.75rem 1.5rem;
			color: var(--text-muted);
			font-size: 0.9rem;
		}

		.joke-punchline.hidden:hover {
			border-color: var(--warning);
			color: var(--warning);
		}

		.joke-type {
			display: inline-block;
			padding: 0.25rem 0.75rem;
			background: var(--surface-hover);
			border-radius: 4px;
			font-size: 0.75rem;
			color: var(--accent-alt);
			text-transform: uppercase;
			letter-spacing: 0.05em;
		}

		.toolbar {
			display: flex;
			gap: 0.5rem;
			justify-content: center;
			margin-top: 1.5rem;
			flex-wrap: wrap;
		}

		button {
			padding: 0.75rem 1.5rem;
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 6px;
			color: var(--text);
			font-family: inherit;
			font-size: 0.85rem;
			cursor: pointer;
			transition: all 0.2s;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		button:hover {
			background: var(--surface-hover);
			border-color: var(--accent);
		}

		button.primary {
			background: var(--accent);
			border-color: var(--accent);
			color: #000;
			font-weight: 500;
		}

		button.primary:hover {
			background: #0ea572;
			border-color: #0ea572;
		}

		.stats {
			display: flex;
			gap: 1.5rem;
			justify-content: center;
			padding: 1rem;
			background: var(--bg);
			border-radius: 6px;
			font-size: 0.8rem;
		}

		.stat-item {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 0.25rem;
		}

		.stat-value {
			font-size: 1.2rem;
			font-weight: 600;
			color: var(--accent);
		}

		.stat-label { color: var(--text-muted); }

		.history-panel {
			max-height: 300px;
			overflow-y: auto;
		}

		.history-item {
			padding: 1rem;
			border-bottom: 1px solid var(--border);
			cursor: pointer;
			transition: background 0.2s;
		}

		.history-item:last-child { border-bottom: none; }

		.history-item:hover { background: var(--surface-hover); }

		.history-setup {
			color: var(--text);
			font-size: 0.85rem;
			margin-bottom: 0.5rem;
		}

		.history-punchline {
			color: var(--warning);
			font-size: 0.8rem;
		}

		.history-meta {
			display: flex;
			justify-content: space-between;
			margin-top: 0.5rem;
			font-size: 0.7rem;
			color: var(--text-muted);
		}

		.empty-state {
			padding: 2rem;
			text-align: center;
			color: var(--text-muted);
			font-size: 0.9rem;
		}

		.loading {
			color: var(--text-muted);
			font-size: 0.9rem;
		}

		.error-message {
			color: var(--danger);
			font-size: 0.9rem;
			padding: 1rem;
			background: rgba(239, 68, 68, 0.1);
			border-radius: 6px;
		}

		.keyboard-hint {
			margin-top: 1rem;
			font-size: 0.75rem;
			color: var(--text-muted);
		}

		kbd {
			padding: 0.15rem 0.4rem;
			background: var(--surface-hover);
			border: 1px solid var(--border);
			border-radius: 3px;
			font-family: inherit;
			font-size: 0.7rem;
		}

		.back-link {
			display: inline-block;
			margin-top: 1rem;
			color: var(--text-muted);
			text-decoration: none;
			font-size: 0.875rem;
		}

		.back-link:hover { color: var(--accent); }

		@keyframes bounce {
			0%, 100% { transform: translateY(0); }
			50% { transform: translateY(-5px); }
		}

		.bounce {
			animation: bounce 0.5s ease;
		}
	</style>
</head>
<body>
	<div class="container">
		<header>
			<h1>Dad Jokes</h1>
			<p class="subtitle">Random jokes to brighten your day</p>
		</header>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Today's Joke</span>
				<span class="joke-type" id="jokeType">-</span>
			</div>
			<div class="panel-content">
				<div class="joke-container" id="jokeContainer">
					<div class="loading">Loading joke...</div>
				</div>
				<div class="toolbar">
					<button class="primary" onclick="fetchNewJoke()">
						<span>New Joke</span>
					</button>
					<button onclick="revealPunchline()" id="revealBtn" style="display: none;">
						<span>Reveal Answer</span>
					</button>
					<button onclick="copyJoke()">
						<span>Copy</span>
					</button>
					<button onclick="shareJoke()">
						<span>Share</span>
					</button>
				</div>
				<div class="keyboard-hint">
					Press <kbd>Space</kbd> for new joke, <kbd>Enter</kbd> to reveal answer
				</div>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Statistics</span>
			</div>
			<div class="panel-content" style="padding: 1rem;">
				<div class="stats">
					<div class="stat-item">
						<span class="stat-value" id="jokesViewed">0</span>
						<span class="stat-label">Jokes Viewed</span>
					</div>
					<div class="stat-item">
						<span class="stat-value" id="totalJokes">0</span>
						<span class="stat-label">Total Available</span>
					</div>
					<div class="stat-item">
						<span class="stat-value" id="punchlineRate">0%</span>
						<span class="stat-label">Reveals</span>
					</div>
				</div>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Recent Jokes</span>
				<button onclick="clearHistory()" style="padding: 0.25rem 0.5rem; font-size: 0.7rem;">Clear</button>
			</div>
			<div class="history-panel" id="historyPanel">
				<div class="empty-state">No jokes viewed yet</div>
			</div>
		</div>

		<a href="/" class="back-link">&larr; Back to home</a>
	</div>

	<script>
		let jokes = [];
		let currentJoke = null;
		let history = [];
		let stats = {
			viewed: 0,
			revealed: 0
		};

		// Load stats from localStorage
		function loadStats() {
			const saved = localStorage.getItem('dadJokeStats');
			if (saved) {
				stats = JSON.parse(saved);
			}
			const savedHistory = localStorage.getItem('dadJokeHistory');
			if (savedHistory) {
				history = JSON.parse(savedHistory);
			}
			updateStatsDisplay();
			updateHistoryDisplay();
		}

		function saveStats() {
			localStorage.setItem('dadJokeStats', JSON.stringify(stats));
			localStorage.setItem('dadJokeHistory', JSON.stringify(history.slice(0, 20))); // Keep last 20
		}

		function updateStatsDisplay() {
			document.getElementById('jokesViewed').textContent = stats.viewed;
			document.getElementById('totalJokes').textContent = jokes.length;
			const rate = stats.viewed > 0 ? Math.round((stats.revealed / stats.viewed) * 100) : 0;
			document.getElementById('punchlineRate').textContent = rate + '%';
		}

		function updateHistoryDisplay() {
			const panel = document.getElementById('historyPanel');
			if (history.length === 0) {
				panel.innerHTML = '<div class="empty-state">No jokes viewed yet</div>';
				return;
			}

			panel.innerHTML = history.map((joke, i) => `
				<div class="history-item" onclick="showHistoryJoke(${i})">
					<div class="history-setup">${escapeHtml(joke.body)}</div>
					${joke.answer ? `<div class="history-punchline">${escapeHtml(joke.answer)}</div>` : ''}
					<div class="history-meta">
						<span class="joke-type" style="padding: 0.1rem 0.4rem;">${joke.type}</span>
					</div>
				</div>
			`).join('');
		}

		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		async function loadJokes() {
			try {
				const response = await fetch('jokes.json');
				const data = await response.json();
				jokes = data.jokes;
				updateStatsDisplay();
				fetchNewJoke();
			} catch (error) {
				document.getElementById('jokeContainer').innerHTML =
					'<div class="error-message">Failed to load jokes. Please refresh the page.</div>';
			}
		}

		function fetchNewJoke() {
			if (jokes.length === 0) return;

			const randomIndex = Math.floor(Math.random() * jokes.length);
			currentJoke = jokes[randomIndex];

			stats.viewed++;

			// Add to history
			if (!history.some(j => j.body === currentJoke.body)) {
				history.unshift({...currentJoke, viewedAt: new Date().toISOString()});
			}

			saveStats();
			updateStatsDisplay();
			updateHistoryDisplay();

			displayJoke(currentJoke);
		}

		function displayJoke(joke, showAnswer = false) {
			currentJoke = joke;
			const container = document.getElementById('jokeContainer');
			const typeEl = document.getElementById('jokeType');
			const revealBtn = document.getElementById('revealBtn');

			typeEl.textContent = joke.type;

			if (joke.type === 'pun') {
				container.innerHTML = `<div class="joke-setup bounce">${escapeHtml(joke.body)}</div>`;
				revealBtn.style.display = 'none';
			} else {
				const revealed = showAnswer ? 'revealed' : 'hidden';
				const punchlineContent = showAnswer ? escapeHtml(joke.answer) : 'Click to reveal answer';
				container.innerHTML = `
					<div class="joke-setup bounce">${escapeHtml(joke.body)}</div>
					<div class="joke-punchline ${revealed}" onclick="revealPunchline()">${punchlineContent}</div>
				`;
				revealBtn.style.display = showAnswer ? 'none' : 'flex';
			}
		}

		function revealPunchline() {
			if (!currentJoke || currentJoke.type !== 'question') return;

			const punchline = document.querySelector('.joke-punchline');
			if (punchline && !punchline.classList.contains('revealed')) {
				punchline.textContent = currentJoke.answer;
				punchline.classList.remove('hidden');
				punchline.classList.add('revealed');
				document.getElementById('revealBtn').style.display = 'none';

				stats.revealed++;
				saveStats();
				updateStatsDisplay();
			}
		}

		function showHistoryJoke(index) {
			const joke = history[index];
			displayJoke(joke, true);
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}

		function copyJoke() {
			if (!currentJoke) return;

			let text = currentJoke.body;
			if (currentJoke.answer) {
				text += '\n\n' + currentJoke.answer;
			}

			navigator.clipboard.writeText(text).then(() => {
				const btn = event.target.closest('button');
				const originalText = btn.querySelector('span').textContent;
				btn.querySelector('span').textContent = 'Copied!';
				setTimeout(() => btn.querySelector('span').textContent = originalText, 1500);
			});
		}

		function shareJoke() {
			if (!currentJoke) return;

			let text = currentJoke.body;
			if (currentJoke.answer) {
				text += '\n\n' + currentJoke.answer;
			}

			if (navigator.share) {
				navigator.share({
					title: 'Dad Joke',
					text: text
				});
			} else {
				copyJoke();
			}
		}

		function clearHistory() {
			history = [];
			stats = { viewed: 0, revealed: 0 };
			saveStats();
			updateStatsDisplay();
			updateHistoryDisplay();
		}

		// Keyboard shortcuts
		document.addEventListener('keydown', (e) => {
			if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

			if (e.code === 'Space') {
				e.preventDefault();
				fetchNewJoke();
			} else if (e.code === 'Enter') {
				e.preventDefault();
				revealPunchline();
			}
		});

		// Initialize
		loadStats();
		loadJokes();
	</script>
</body>
</html>
