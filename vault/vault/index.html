<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>HashiCorp Vault – Comprehensive Notes & Procedures // rowstu.net</title><link rel=stylesheet href=/assets/shared-theme.css><style>.markdown-content{max-width:900px;margin:0 auto;line-height:1.7}.markdown-content h1{font-size:2.5rem;margin-bottom:1rem;color:var(--accent-teal);border-bottom:2px solid var(--border);padding-bottom:.5rem}.markdown-content h2{font-size:2rem;margin-top:2rem;margin-bottom:1rem;color:var(--accent-orange)}.markdown-content h3{font-size:1.5rem;margin-top:1.5rem;margin-bottom:.75rem;color:var(--text-primary)}.markdown-content p{margin-bottom:1rem}.markdown-content code{background:var(--bg-light);padding:.2rem .4rem;border-radius:3px;font-family:jetbrains mono,monospace;font-size:.9em}.markdown-content pre{background:var(--bg-light);padding:1rem;border-radius:6px;overflow-x:auto;margin-bottom:1rem}.markdown-content pre code{background:0 0;padding:0}.markdown-content a{color:var(--accent-teal);text-decoration:none}.markdown-content a:hover{text-decoration:underline}.markdown-content ul,.markdown-content ol{margin-bottom:1rem;padding-left:2rem}.markdown-content li{margin-bottom:.5rem}.markdown-content blockquote{border-left:4px solid var(--accent-teal);padding-left:1rem;margin:1rem 0;color:var(--text-secondary);font-style:italic}.markdown-content table{width:100%;border-collapse:collapse;margin-bottom:1rem}.markdown-content th,.markdown-content td{border:1px solid var(--border);padding:.75rem;text-align:left}.markdown-content th{background:var(--bg-light);font-weight:600}.breadcrumb{padding:1rem 0;color:var(--text-secondary);font-size:.95rem}.breadcrumb a{color:var(--accent-teal);text-decoration:none}.breadcrumb a:hover{text-decoration:underline}</style></head><body><div class=app-header><h1 class=app-title>HashiCorp Vault – Comprehensive Notes & Procedures</h1></div><div class=container><div class=breadcrumb><a href=/>Home</a> / <a href=/browse/>Browse</a>/ <a href=/vaultvault/>Vaultvault</a></div><div class="card markdown-content"><h3 id=11-overview>1.1 Overview</h3><p>HashiCorp Vault is a centralized secrets management and security platform designed to securely store, access, and manage sensitive data such as passwords, API keys, certificates, encryption keys, and tokens. It provides fine-grained access control, strong encryption, and detailed audit logging.</p><p><strong>Key goals of Vault:</strong></p><ul><li>Eliminate hard-coded secrets in code and configuration</li><li>Centralize secret storage and access</li><li>Enforce least-privilege access</li><li>Provide auditable access to sensitive data</li></ul><h3 id=12-key-features>1.2 Key Features</h3><ul><li><strong>Secrets Management</strong>: Store static secrets or generate dynamic, short-lived secrets</li><li><strong>Encryption as a Service</strong>: Encrypt/decrypt data without exposing keys</li><li><strong>Identity-Based Access Control</strong>: Fine-grained policies tied to users, apps, or machines</li><li><strong>Audit Logging</strong>: Track every access request</li><li><strong>Pluggable Architecture</strong>: Supports multiple auth methods and secret backends</li><li><strong>High Availability (HA)</strong>: Supports clustering and failover</li></ul><h3 id=13-common-use-cases>1.3 Common Use Cases</h3><ul><li>Managing database credentials dynamically (e.g., MySQL, PostgreSQL)</li><li>Storing API keys and tokens for applications</li><li>PKI and certificate lifecycle management</li><li>Kubernetes secrets injection</li><li>Cloud IAM credential brokering (AWS, GCP, Azure)</li><li>Encrypting application data at rest</li></ul><hr><h2 id=2-installation-and-setup>2. Installation and Setup</h2><h3 id=21-installation-methods>2.1 Installation Methods</h3><h4 id=211-linux-binary-install>2.1.1 Linux (Binary Install)</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://releases.hashicorp.com/vault/&lt;version&gt;/vault_&lt;version&gt;_linux_amd64.zip
</span></span><span style=display:flex><span>unzip vault_&lt;version&gt;_linux_amd64.zip
</span></span><span style=display:flex><span>sudo mv vault /usr/local/bin/
</span></span><span style=display:flex><span>vault --version
</span></span></code></pre></div><h4 id=212-package-manager-example-debianubuntu>2.1.2 Package Manager (Example: Debian/Ubuntu)</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span style=color:#66d9ef>$(</span>lsb_release -cs<span style=color:#66d9ef>)</span><span style=color:#e6db74> main&#34;</span> | sudo tee /etc/apt/sources.list.d/hashicorp.list
</span></span><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install vault
</span></span></code></pre></div><h4 id=213-docker>2.1.3 Docker</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --cap-add<span style=color:#f92672>=</span>IPC_LOCK -p 8200:8200 hashicorp/vault
</span></span></code></pre></div><hr><h3 id=22-initial-configuration>2.2 Initial Configuration</h3><p>Minimal configuration example (<code>/etc/vault.d/vault.hcl</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>storage</span> <span style=color:#e6db74>&#34;file&#34;</span> {
</span></span><span style=display:flex><span>  path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/opt/vault/data&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>listener</span> <span style=color:#e6db74>&#34;tcp&#34;</span> {
</span></span><span style=display:flex><span>  address     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0:8200&#34;</span>
</span></span><span style=display:flex><span>  tls_disable <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ui <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>Start Vault:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault server -config<span style=color:#f92672>=</span>/etc/vault.d/vault.hcl
</span></span></code></pre></div><blockquote><p>⚠️ <strong>Note</strong>: TLS must be enabled for production environments.</p></blockquote><h3 id=23-configuration-best-practices>2.3 Configuration Best Practices</h3><ul><li>Always enable TLS</li><li>Use a production-grade storage backend (Raft, Consul)</li><li>Run Vault as a dedicated service account</li><li>Restrict network access to Vault</li><li>Enable audit logging from day one</li></ul><hr><h2 id=3-core-concepts>3. Core Concepts</h2><h3 id=31-secrets-management>3.1 Secrets Management</h3><p>Secrets are sensitive values that must be protected. Vault stores secrets encrypted at rest and controls access via policies.</p><p><strong>Types of secrets:</strong></p><ul><li>Static (manually stored)</li><li>Dynamic (generated on demand, short TTL)</li></ul><h3 id=32-identity-and-access-management>3.2 Identity and Access Management</h3><p>Vault authenticates users and machines using <strong>authentication methods</strong>, then authorizes access using <strong>policies</strong>.</p><h3 id=33-important-terminology>3.3 Important Terminology</h3><table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody><tr><td><strong>Secrets Engine</strong></td><td>Backend that stores or generates secrets</td></tr><tr><td><strong>Auth Method</strong></td><td>Mechanism to authenticate (e.g., AppRole, LDAP, Kubernetes)</td></tr><tr><td><strong>Policy</strong></td><td>Rules defining what paths can be accessed and how</td></tr><tr><td><strong>Token</strong></td><td>Credential issued after authentication</td></tr><tr><td><strong>Lease / TTL</strong></td><td>Time a secret or token is valid</td></tr><tr><td><strong>Seal</strong></td><td>State where Vault is locked and inaccessible</td></tr><tr><td><strong>Unseal</strong></td><td>Process of decrypting Vault’s master key</td></tr></tbody></table><h3 id=34-secrets-engines>3.4 Secrets Engines</h3><p>Examples:</p><ul><li>KV (Key-Value)</li><li>Database</li><li>PKI</li><li>AWS / Azure / GCP</li></ul><p>Enable a secrets engine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault secrets enable kv
</span></span></code></pre></div><hr><h2 id=4-using-hashicorp-vault>4. Using HashiCorp Vault</h2><h3 id=41-initializing-vault>4.1 Initializing Vault</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault operator init
</span></span></code></pre></div><p>This generates:</p><ul><li>Unseal keys (default: 5)</li><li>Initial root token</li></ul><p>Store these securely and offline.</p><h3 id=42-sealing-and-unsealing>4.2 Sealing and Unsealing</h3><p>Unseal Vault:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault operator unseal
</span></span></code></pre></div><p>(Repeat until threshold is met)</p><p>Seal Vault:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault operator seal
</span></span></code></pre></div><h3 id=43-storing-and-retrieving-secrets>4.3 Storing and Retrieving Secrets</h3><p>Store a secret:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault kv put secret/db password<span style=color:#f92672>=</span>supersecret
</span></span></code></pre></div><p>Retrieve a secret:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault kv get secret/db
</span></span></code></pre></div><h3 id=44-policies-and-access-control>4.4 Policies and Access Control</h3><p>Example policy (<code>db-read.hcl</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>path</span> <span style=color:#e6db74>&#34;secret/data/db&#34;</span> {
</span></span><span style=display:flex><span>  capabilities <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;read&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Apply policy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault policy write db-read db-read.hcl
</span></span></code></pre></div><h3 id=45-authentication-methods>4.5 Authentication Methods</h3><p>Enable AppRole:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault auth enable approle
</span></span></code></pre></div><p>Create role:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault write auth/approle/role/myapp token_policies<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;db-read&#34;</span>
</span></span></code></pre></div><h3 id=46-cloud-and-application-integration>4.6 Cloud and Application Integration</h3><p>Examples:</p><ul><li><strong>Kubernetes</strong>: Pods authenticate using service accounts</li><li><strong>AWS</strong>: EC2 instances authenticate via IAM</li><li><strong>Applications</strong>: Use Vault Agent or SDKs</li></ul><p>Vault Agent example:</p><ul><li>Auto-authentication</li><li>Secret templating</li><li>Token renewal</li></ul><hr><h2 id=5-best-practices>5. Best Practices</h2><h3 id=51-security-recommendations>5.1 Security Recommendations</h3><ul><li>Never expose root token</li><li>Use short-lived tokens</li><li>Enable audit devices</li><li>Rotate secrets regularly</li><li>Use namespaces (Enterprise)</li></ul><h3 id=52-backup-and-recovery>5.2 Backup and Recovery</h3><ul><li>Backup storage backend regularly</li><li>Secure unseal keys</li><li>Test restore procedures</li></ul><p>For Raft:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault operator raft snapshot save backup.snap
</span></span></code></pre></div><h3 id=53-scaling-and-performance>5.3 Scaling and Performance</h3><ul><li>Use integrated Raft storage</li><li>Enable HA mode</li><li>Tune cache and TTL values</li><li>Separate read-heavy workloads</li></ul><hr><h2 id=6-common-issues-and-troubleshooting>6. Common Issues and Troubleshooting</h2><h3 id=61-common-problems>6.1 Common Problems</h3><table><thead><tr><th>Issue</th><th>Cause</th><th>Solution</th></tr></thead><tbody><tr><td>Vault sealed</td><td>Restart or crash</td><td>Unseal using keys</td></tr><tr><td>Permission denied</td><td>Policy issue</td><td>Review policy paths</td></tr><tr><td>Token expired</td><td>TTL reached</td><td>Re-authenticate</td></tr><tr><td>Slow performance</td><td>Storage bottleneck</td><td>Optimize backend</td></tr></tbody></table><h3 id=62-monitoring-and-logging>6.2 Monitoring and Logging</h3><ul><li>Enable audit logging:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vault audit enable file file_path<span style=color:#f92672>=</span>/var/log/vault_audit.log
</span></span></code></pre></div><ul><li><p>Monitor metrics via:</p><ul><li>Prometheus</li><li>Datadog</li></ul></li><li><p>Key metrics:</p><ul><li>Request latency</li><li>Token count</li><li>Seal/unseal events</li></ul></li></ul><hr></div></div><script src=/assets/shared-nav.js></script></body></html>