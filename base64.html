<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Base64 Encoder/Decoder</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg: #1a1d23;
			--surface: #252932;
			--surface-hover: #2d323d;
			--border: #3d4351;
			--text: #e4e7eb;
			--text-muted: #9ca3af;
			--accent: #10b981;
			--danger: #ef4444;
		}

		* { margin: 0; padding: 0; box-sizing: border-box; }

		body {
			font-family: 'IBM Plex Mono', monospace;
			background: var(--bg);
			color: var(--text);
			min-height: 100vh;
			padding: 1.5rem;
		}

		.container { max-width: 800px; margin: 0 auto; }

		header { margin-bottom: 1.5rem; }

		h1 {
			font-size: 1.5rem;
			font-weight: 600;
			color: var(--accent);
			margin-bottom: 0.5rem;
		}

		.subtitle { color: var(--text-muted); font-size: 0.875rem; }

		.toolbar {
			display: flex;
			gap: 0.5rem;
			margin-bottom: 1rem;
			flex-wrap: wrap;
		}

		button {
			padding: 0.5rem 1rem;
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 4px;
			color: var(--text);
			font-family: inherit;
			font-size: 0.8rem;
			cursor: pointer;
			transition: all 0.2s;
		}

		button:hover {
			background: var(--surface-hover);
			border-color: var(--accent);
		}

		button.primary {
			background: var(--accent);
			border-color: var(--accent);
			color: #000;
		}

		button.primary:hover { opacity: 0.9; }

		.panel {
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 6px;
			margin-bottom: 1rem;
			overflow: hidden;
		}

		.panel-header {
			padding: 0.75rem 1rem;
			border-bottom: 1px solid var(--border);
			font-size: 0.8rem;
			color: var(--text-muted);
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.panel-header .label { font-weight: 500; color: var(--text); }

		textarea {
			width: 100%;
			height: 150px;
			padding: 1rem;
			background: transparent;
			border: none;
			color: var(--text);
			font-family: inherit;
			font-size: 0.85rem;
			line-height: 1.6;
			resize: vertical;
			outline: none;
		}

		textarea::placeholder { color: var(--text-muted); }

		.error {
			color: var(--danger);
			font-size: 0.8rem;
			padding: 0.5rem 1rem;
			background: rgba(239, 68, 68, 0.1);
			display: none;
		}

		.error.visible { display: block; }

		.stats {
			padding: 0.5rem 1rem;
			border-top: 1px solid var(--border);
			font-size: 0.75rem;
			color: var(--text-muted);
			display: flex;
			gap: 1.5rem;
		}

		.stats span { color: var(--text); }

		.back-link {
			display: inline-block;
			margin-top: 1rem;
			color: var(--text-muted);
			text-decoration: none;
			font-size: 0.875rem;
		}

		.back-link:hover { color: var(--accent); }

		.mode-toggle {
			display: flex;
			gap: 0.25rem;
			background: var(--bg);
			padding: 0.25rem;
			border-radius: 4px;
		}

		.mode-btn {
			padding: 0.35rem 0.75rem;
			background: transparent;
			border: none;
			color: var(--text-muted);
			font-size: 0.75rem;
			cursor: pointer;
			border-radius: 3px;
		}

		.mode-btn.active {
			background: var(--surface);
			color: var(--accent);
		}
	</style>
</head>
<body>
	<div class="container">
		<header>
			<h1>Base64 Encoder/Decoder</h1>
			<p class="subtitle">Encode text to Base64 or decode Base64 to text</p>
		</header>

		<div class="toolbar">
			<button class="primary" onclick="encode()">Encode</button>
			<button onclick="decode()">Decode</button>
			<button onclick="copyOutput()">Copy Output</button>
			<button onclick="swapValues()">Swap</button>
			<button onclick="clearAll()">Clear</button>
			<div class="mode-toggle">
				<button class="mode-btn active" onclick="setMode('text', this)">Text</button>
				<button class="mode-btn" onclick="setMode('url', this)">URL Safe</button>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Input</span>
			</div>
			<textarea id="input" placeholder="Enter text to encode or Base64 to decode..." oninput="updateStats()"></textarea>
			<div class="stats" id="inputStats">
				Characters: <span>0</span> | Bytes: <span>0</span>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Output</span>
			</div>
			<textarea id="output" placeholder="Result will appear here..." readonly></textarea>
			<div class="error" id="error"></div>
			<div class="stats" id="outputStats">
				Characters: <span>0</span> | Bytes: <span>0</span>
			</div>
		</div>

		<a href="/" class="back-link">&larr; Back to home</a>
	</div>

	<script>
		const input = document.getElementById('input');
		const output = document.getElementById('output');
		const error = document.getElementById('error');
		let urlSafeMode = false;

		function setMode(mode, btn) {
			urlSafeMode = mode === 'url';
			document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
		}

		function encode() {
			error.classList.remove('visible');
			const text = input.value;
			if (!text) {
				output.value = '';
				updateStats();
				return;
			}

			try {
				// Handle Unicode properly
				const utf8 = new TextEncoder().encode(text);
				const binary = String.fromCharCode(...utf8);
				let encoded = btoa(binary);

				if (urlSafeMode) {
					encoded = encoded.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
				}

				output.value = encoded;
			} catch (e) {
				error.textContent = 'Error encoding: ' + e.message;
				error.classList.add('visible');
			}
			updateStats();
		}

		function decode() {
			error.classList.remove('visible');
			let text = input.value.trim();
			if (!text) {
				output.value = '';
				updateStats();
				return;
			}

			try {
				// Convert URL-safe back to standard Base64
				if (urlSafeMode || text.includes('-') || text.includes('_')) {
					text = text.replace(/-/g, '+').replace(/_/g, '/');
					// Add padding if needed
					while (text.length % 4) {
						text += '=';
					}
				}

				const binary = atob(text);
				const bytes = new Uint8Array(binary.length);
				for (let i = 0; i < binary.length; i++) {
					bytes[i] = binary.charCodeAt(i);
				}
				const decoded = new TextDecoder().decode(bytes);
				output.value = decoded;
			} catch (e) {
				error.textContent = 'Invalid Base64 input';
				error.classList.add('visible');
				output.value = '';
			}
			updateStats();
		}

		function copyOutput() {
			navigator.clipboard.writeText(output.value).then(() => {
				const btn = event.target;
				const orig = btn.textContent;
				btn.textContent = 'Copied!';
				setTimeout(() => btn.textContent = orig, 1500);
			});
		}

		function swapValues() {
			const temp = input.value;
			input.value = output.value;
			output.value = temp;
			updateStats();
		}

		function clearAll() {
			input.value = '';
			output.value = '';
			error.classList.remove('visible');
			updateStats();
		}

		function updateStats() {
			const inputStats = document.getElementById('inputStats');
			const outputStats = document.getElementById('outputStats');

			const inputBytes = new Blob([input.value]).size;
			const outputBytes = new Blob([output.value]).size;

			inputStats.innerHTML = `Characters: <span>${input.value.length}</span> | Bytes: <span>${inputBytes}</span>`;
			outputStats.innerHTML = `Characters: <span>${output.value.length}</span> | Bytes: <span>${outputBytes}</span>`;
		}

		// Auto-detect and process on paste
		input.addEventListener('paste', () => {
			setTimeout(() => {
				const text = input.value.trim();
				// Check if it looks like Base64
				if (/^[A-Za-z0-9+/=_-]+$/.test(text) && text.length > 10) {
					decode();
				}
			}, 0);
		});
	</script>
</body>
</html>
