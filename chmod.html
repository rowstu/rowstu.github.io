<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chmod Calculator</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg: #1a1d23;
			--surface: #252932;
			--surface-hover: #2d323d;
			--border: #3d4351;
			--text: #e4e7eb;
			--text-muted: #9ca3af;
			--accent: #10b981;
			--accent-alt: #8b5cf6;
			--warning: #f59e0b;
			--danger: #ef4444;
		}

		* { margin: 0; padding: 0; box-sizing: border-box; }

		body {
			font-family: 'IBM Plex Mono', monospace;
			background: var(--bg);
			color: var(--text);
			min-height: 100vh;
			padding: 1.5rem;
		}

		.container { max-width: 900px; margin: 0 auto; }

		header { margin-bottom: 1.5rem; }

		h1 {
			font-size: 1.5rem;
			font-weight: 600;
			color: var(--accent);
			margin-bottom: 0.5rem;
		}

		.subtitle { color: var(--text-muted); font-size: 0.875rem; }

		.panel {
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 6px;
			margin-bottom: 1rem;
			overflow: hidden;
		}

		.panel-header {
			padding: 0.75rem 1rem;
			border-bottom: 1px solid var(--border);
			font-size: 0.8rem;
			color: var(--text-muted);
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.panel-header .label { font-weight: 500; color: var(--text); }

		.panel-content { padding: 1rem; }

		.permission-grid {
			display: grid;
			grid-template-columns: 100px repeat(3, 1fr);
			gap: 0.5rem;
			margin-bottom: 1.5rem;
		}

		.permission-header {
			font-weight: 600;
			text-align: center;
			padding: 0.5rem;
			color: var(--accent);
		}

		.permission-label {
			display: flex;
			align-items: center;
			padding: 0.5rem;
			color: var(--text-muted);
		}

		.permission-cell {
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 0.5rem;
		}

		.checkbox-wrapper {
			position: relative;
			width: 40px;
			height: 40px;
		}

		.checkbox-wrapper input {
			position: absolute;
			opacity: 0;
			width: 100%;
			height: 100%;
			cursor: pointer;
			z-index: 1;
		}

		.checkbox-display {
			width: 100%;
			height: 100%;
			background: var(--surface-hover);
			border: 2px solid var(--border);
			border-radius: 6px;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 1.1rem;
			color: var(--text-muted);
			transition: all 0.2s;
		}

		.checkbox-wrapper input:checked + .checkbox-display {
			background: var(--accent);
			border-color: var(--accent);
			color: #000;
		}

		.checkbox-wrapper:hover .checkbox-display {
			border-color: var(--accent);
		}

		.special-bits {
			display: flex;
			gap: 1rem;
			padding: 1rem;
			background: var(--surface-hover);
			border-radius: 6px;
			margin-bottom: 1rem;
			flex-wrap: wrap;
		}

		.special-bit {
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.special-bit input {
			display: none;
		}

		.special-bit label {
			padding: 0.5rem 1rem;
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 4px;
			cursor: pointer;
			font-size: 0.85rem;
			transition: all 0.2s;
		}

		.special-bit input:checked + label {
			background: var(--accent-alt);
			border-color: var(--accent-alt);
			color: #fff;
		}

		.special-bit label:hover {
			border-color: var(--accent-alt);
		}

		.input-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
			margin-bottom: 1rem;
		}

		@media (max-width: 600px) {
			.input-row { grid-template-columns: 1fr; }
		}

		.input-group label {
			display: block;
			margin-bottom: 0.5rem;
			font-size: 0.85rem;
			color: var(--text-muted);
		}

		input[type="text"] {
			width: 100%;
			padding: 0.75rem 1rem;
			background: var(--surface-hover);
			border: 1px solid var(--border);
			border-radius: 4px;
			color: var(--text);
			font-family: inherit;
			font-size: 1rem;
			outline: none;
			transition: border-color 0.2s;
		}

		input[type="text"]:focus {
			border-color: var(--accent);
		}

		input[type="text"]::placeholder { color: var(--text-muted); }

		.output-box {
			background: var(--surface-hover);
			border: 1px solid var(--border);
			border-radius: 6px;
			padding: 1rem;
			margin-bottom: 1rem;
		}

		.output-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0.5rem 0;
			border-bottom: 1px solid var(--border);
		}

		.output-row:last-child { border-bottom: none; }

		.output-label { color: var(--text-muted); font-size: 0.85rem; }

		.output-value {
			font-weight: 600;
			color: var(--accent);
			font-size: 1rem;
		}

		.preview {
			font-family: inherit;
			font-size: 1.5rem;
			letter-spacing: 0.5rem;
			text-align: center;
			padding: 1rem;
			background: var(--bg);
			border-radius: 6px;
			margin-bottom: 1rem;
		}

		.preview .perm {
			display: inline-block;
			padding: 0.25rem;
		}

		.preview .perm.r { color: #ff7b72; }
		.preview .perm.w { color: #79c0ff; }
		.preview .perm.x { color: #7ee787; }
		.preview .perm.s { color: #d2a8ff; }
		.preview .perm.t { color: #ffa657; }
		.preview .perm.dash { color: var(--text-muted); }

		.command-box {
			background: var(--bg);
			border-radius: 6px;
			padding: 1rem;
			font-size: 0.9rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 0.5rem;
		}

		.command-box code {
			color: var(--accent);
		}

		button {
			padding: 0.5rem 1rem;
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 4px;
			color: var(--text);
			font-family: inherit;
			font-size: 0.8rem;
			cursor: pointer;
			transition: all 0.2s;
		}

		button:hover {
			background: var(--surface-hover);
			border-color: var(--accent);
		}

		.reference {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 0.5rem;
			font-size: 0.75rem;
		}

		.ref-item {
			display: flex;
			gap: 0.5rem;
			padding: 0.5rem;
			background: var(--surface-hover);
			border-radius: 4px;
		}

		.ref-num { color: var(--accent); font-weight: 600; min-width: 30px; }
		.ref-sym { color: var(--accent-alt); min-width: 40px; }
		.ref-desc { color: var(--text-muted); }

		.back-link {
			display: inline-block;
			margin-top: 1rem;
			color: var(--text-muted);
			text-decoration: none;
			font-size: 0.875rem;
		}

		.back-link:hover { color: var(--accent); }
	</style>
</head>
<body>
	<div class="container">
		<header>
			<h1>Chmod Calculator</h1>
			<p class="subtitle">Unix/Linux file permission calculator with visual editor</p>
		</header>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Permission Editor</span>
			</div>
			<div class="panel-content">
				<div class="permission-grid">
					<div></div>
					<div class="permission-header">Owner</div>
					<div class="permission-header">Group</div>
					<div class="permission-header">Others</div>

					<div class="permission-label">Read (r)</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="owner-r" data-who="owner" data-perm="r" checked>
							<div class="checkbox-display">r</div>
						</div>
					</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="group-r" data-who="group" data-perm="r" checked>
							<div class="checkbox-display">r</div>
						</div>
					</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="others-r" data-who="others" data-perm="r" checked>
							<div class="checkbox-display">r</div>
						</div>
					</div>

					<div class="permission-label">Write (w)</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="owner-w" data-who="owner" data-perm="w" checked>
							<div class="checkbox-display">w</div>
						</div>
					</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="group-w" data-who="group" data-perm="w">
							<div class="checkbox-display">w</div>
						</div>
					</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="others-w" data-who="others" data-perm="w">
							<div class="checkbox-display">w</div>
						</div>
					</div>

					<div class="permission-label">Execute (x)</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="owner-x" data-who="owner" data-perm="x" checked>
							<div class="checkbox-display">x</div>
						</div>
					</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="group-x" data-who="group" data-perm="x" checked>
							<div class="checkbox-display">x</div>
						</div>
					</div>
					<div class="permission-cell">
						<div class="checkbox-wrapper">
							<input type="checkbox" id="others-x" data-who="others" data-perm="x" checked>
							<div class="checkbox-display">x</div>
						</div>
					</div>
				</div>

				<div class="special-bits">
					<span style="color: var(--text-muted); font-size: 0.85rem;">Special:</span>
					<div class="special-bit">
						<input type="checkbox" id="setuid">
						<label for="setuid">SetUID (4)</label>
					</div>
					<div class="special-bit">
						<input type="checkbox" id="setgid">
						<label for="setgid">SetGID (2)</label>
					</div>
					<div class="special-bit">
						<input type="checkbox" id="sticky">
						<label for="sticky">Sticky (1)</label>
					</div>
				</div>

				<div class="input-row">
					<div class="input-group">
						<label for="numeric">Numeric (Octal)</label>
						<input type="text" id="numeric" placeholder="e.g., 755 or 4755" maxlength="4">
					</div>
					<div class="input-group">
						<label for="symbolic">Symbolic</label>
						<input type="text" id="symbolic" placeholder="e.g., rwxr-xr-x" readonly>
					</div>
				</div>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Preview</span>
			</div>
			<div class="panel-content">
				<div class="preview" id="preview">-rwxr-xr-x</div>

				<div class="output-box">
					<div class="output-row">
						<span class="output-label">Octal Notation</span>
						<span class="output-value" id="octalOutput">0755</span>
					</div>
					<div class="output-row">
						<span class="output-label">Symbolic Notation</span>
						<span class="output-value" id="symbolicOutput">rwxr-xr-x</span>
					</div>
					<div class="output-row">
						<span class="output-label">File Type Prefix</span>
						<span class="output-value" id="prefixOutput">- (regular file)</span>
					</div>
				</div>

				<div class="command-box">
					<code id="commandFile">chmod 755 filename</code>
					<button onclick="copyCommand('commandFile')">Copy</button>
				</div>
				<div class="command-box">
					<code id="commandDir">chmod -R 755 directory/</code>
					<button onclick="copyCommand('commandDir')">Copy</button>
				</div>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Quick Reference</span>
			</div>
			<div class="panel-content">
				<div class="reference">
					<div class="ref-item"><span class="ref-num">0</span><span class="ref-sym">---</span><span class="ref-desc">No permissions</span></div>
					<div class="ref-item"><span class="ref-num">1</span><span class="ref-sym">--x</span><span class="ref-desc">Execute only</span></div>
					<div class="ref-item"><span class="ref-num">2</span><span class="ref-sym">-w-</span><span class="ref-desc">Write only</span></div>
					<div class="ref-item"><span class="ref-num">3</span><span class="ref-sym">-wx</span><span class="ref-desc">Write + Execute</span></div>
					<div class="ref-item"><span class="ref-num">4</span><span class="ref-sym">r--</span><span class="ref-desc">Read only</span></div>
					<div class="ref-item"><span class="ref-num">5</span><span class="ref-sym">r-x</span><span class="ref-desc">Read + Execute</span></div>
					<div class="ref-item"><span class="ref-num">6</span><span class="ref-sym">rw-</span><span class="ref-desc">Read + Write</span></div>
					<div class="ref-item"><span class="ref-num">7</span><span class="ref-sym">rwx</span><span class="ref-desc">Full permissions</span></div>
				</div>
			</div>
		</div>

		<a href="/" class="back-link">&larr; Back to home</a>
	</div>

	<script>
		const checkboxes = document.querySelectorAll('.permission-grid input[type="checkbox"]');
		const specialCheckboxes = {
			setuid: document.getElementById('setuid'),
			setgid: document.getElementById('setgid'),
			sticky: document.getElementById('sticky')
		};
		const numericInput = document.getElementById('numeric');
		const symbolicInput = document.getElementById('symbolic');
		const preview = document.getElementById('preview');
		const octalOutput = document.getElementById('octalOutput');
		const symbolicOutput = document.getElementById('symbolicOutput');
		const commandFile = document.getElementById('commandFile');
		const commandDir = document.getElementById('commandDir');

		function getPermissions() {
			const perms = { owner: 0, group: 0, others: 0 };
			const permValues = { r: 4, w: 2, x: 1 };

			checkboxes.forEach(cb => {
				if (cb.checked) {
					perms[cb.dataset.who] += permValues[cb.dataset.perm];
				}
			});

			let special = 0;
			if (specialCheckboxes.setuid.checked) special += 4;
			if (specialCheckboxes.setgid.checked) special += 2;
			if (specialCheckboxes.sticky.checked) special += 1;

			return { ...perms, special };
		}

		function setPermissions(owner, group, others, special = 0) {
			const permValues = { r: 4, w: 2, x: 1 };
			const perms = { owner, group, others };

			checkboxes.forEach(cb => {
				const val = permValues[cb.dataset.perm];
				cb.checked = (perms[cb.dataset.who] & val) === val;
			});

			specialCheckboxes.setuid.checked = (special & 4) === 4;
			specialCheckboxes.setgid.checked = (special & 2) === 2;
			specialCheckboxes.sticky.checked = (special & 1) === 1;
		}

		function numToSymbolic(num) {
			const map = { 4: 'r', 2: 'w', 1: 'x' };
			let result = '';
			[4, 2, 1].forEach(v => {
				result += (num & v) ? map[v] : '-';
			});
			return result;
		}

		function updateDisplay() {
			const { owner, group, others, special } = getPermissions();

			// Build symbolic string
			let ownerStr = numToSymbolic(owner).split('');
			let groupStr = numToSymbolic(group).split('');
			let othersStr = numToSymbolic(others).split('');

			// Apply special bits
			if (special & 4) ownerStr[2] = ownerStr[2] === 'x' ? 's' : 'S';
			if (special & 2) groupStr[2] = groupStr[2] === 'x' ? 's' : 'S';
			if (special & 1) othersStr[2] = othersStr[2] === 'x' ? 't' : 'T';

			const symbolic = ownerStr.join('') + groupStr.join('') + othersStr.join('');
			const octal = special > 0 ? `${special}${owner}${group}${others}` : `${owner}${group}${others}`;

			// Update inputs
			numericInput.value = octal;
			symbolicInput.value = symbolic;

			// Update preview with color coding
			let previewHtml = '<span class="perm dash">-</span>';
			(ownerStr.join('') + groupStr.join('') + othersStr.join('')).split('').forEach(c => {
				const cls = c === '-' ? 'dash' : c.toLowerCase();
				previewHtml += `<span class="perm ${cls}">${c}</span>`;
			});
			preview.innerHTML = previewHtml;

			// Update outputs
			octalOutput.textContent = special > 0 ? `${special}${owner}${group}${others}` : `0${owner}${group}${others}`;
			symbolicOutput.textContent = symbolic;

			// Update commands
			commandFile.innerHTML = `chmod <span style="color:var(--accent)">${octal}</span> filename`;
			commandDir.innerHTML = `chmod -R <span style="color:var(--accent)">${octal}</span> directory/`;
		}

		function parseNumeric(value) {
			if (!/^[0-7]{3,4}$/.test(value)) return null;

			const padded = value.padStart(4, '0');
			return {
				special: parseInt(padded[0]),
				owner: parseInt(padded[1]),
				group: parseInt(padded[2]),
				others: parseInt(padded[3])
			};
		}

		// Event listeners
		checkboxes.forEach(cb => cb.addEventListener('change', updateDisplay));
		Object.values(specialCheckboxes).forEach(cb => cb.addEventListener('change', updateDisplay));

		numericInput.addEventListener('input', function() {
			const value = this.value.replace(/[^0-7]/g, '').slice(0, 4);
			this.value = value;

			const parsed = parseNumeric(value);
			if (parsed) {
				setPermissions(parsed.owner, parsed.group, parsed.others, parsed.special);
				updateDisplay();
			}
		});

		function copyCommand(id) {
			const el = document.getElementById(id);
			const text = el.textContent;
			navigator.clipboard.writeText(text).then(() => {
				const btn = el.nextElementSibling;
				const orig = btn.textContent;
				btn.textContent = 'Copied!';
				setTimeout(() => btn.textContent = orig, 1500);
			});
		}

		// Initialize
		updateDisplay();
	</script>
</body>
</html>
