<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>ArchLinux - Does your system need a reboot? // rowstu.net</title><link rel=stylesheet href=/assets/shared-theme.css><style>.markdown-content{max-width:900px;margin:0 auto;line-height:1.7}.markdown-content h1{font-size:2.5rem;margin-bottom:1rem;color:var(--accent-teal);border-bottom:2px solid var(--border);padding-bottom:.5rem}.markdown-content h2{font-size:2rem;margin-top:2rem;margin-bottom:1rem;color:var(--accent-orange)}.markdown-content h3{font-size:1.5rem;margin-top:1.5rem;margin-bottom:.75rem;color:var(--text-primary)}.markdown-content p{margin-bottom:1rem}.markdown-content code{background:var(--bg-light);padding:.2rem .4rem;border-radius:3px;font-family:jetbrains mono,monospace;font-size:.9em}.markdown-content pre{background:var(--bg-light);padding:1rem;border-radius:6px;overflow-x:auto;margin-bottom:1rem}.markdown-content pre code{background:0 0;padding:0}.markdown-content a{color:var(--accent-teal);text-decoration:none}.markdown-content a:hover{text-decoration:underline}.markdown-content ul,.markdown-content ol{margin-bottom:1rem;padding-left:2rem}.markdown-content li{margin-bottom:.5rem}.markdown-content blockquote{border-left:4px solid var(--accent-teal);padding-left:1rem;margin:1rem 0;color:var(--text-secondary);font-style:italic}.markdown-content table{width:100%;border-collapse:collapse;margin-bottom:1rem}.markdown-content th,.markdown-content td{border:1px solid var(--border);padding:.75rem;text-align:left}.markdown-content th{background:var(--bg-light);font-weight:600}.breadcrumb{padding:1rem 0;color:var(--text-secondary);font-size:.95rem}.breadcrumb a{color:var(--accent-teal);text-decoration:none}.breadcrumb a:hover{text-decoration:underline}</style></head><body><div class=app-header><h1 class=app-title>ArchLinux - Does your system need a reboot?</h1></div><div class=container><div class=breadcrumb><a href=/>Home</a> / <a href=/browse/>Browse</a>/ <a href=/linuxarch-needs-reboot/>Linuxarch Needs Reboot</a></div><div class="card markdown-content"><p>Under RHEL, there&rsquo;s an application called <strong>needs-restarting</strong>. It checks if the system needs a reboot after installing packages, ensuring the latest kernel, systemd, and libraries are in use.</p><p>In ArchLinux, there&rsquo;s no built-in equivalent, but you can use an AUR application called <strong>reboot-arch-btw</strong> or you can roll your own with the following BASH script:</p><pre tabindex=0><code>#!/bin/bash
#
# arch-needs-reboot.sh
# Check if Arch Linux system needs a reboot after updates
#

set -euo pipefail

# Color codes
RED=&#39;\033[0;31m&#39;
YELLOW=&#39;\033[1;33m&#39;
GREEN=&#39;\033[0;32m&#39;
BLUE=&#39;\033[0;34m&#39;
NC=&#39;\033[0m&#39; # No Color

REBOOT_NEEDED=0
VERBOSE=${VERBOSE:-0}

# Parse arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        -v|--verbose)
            VERBOSE=1
            shift
            ;;
        -h|--help)
            echo &#34;Usage: $0 [-v|--verbose] [-h|--help]&#34;
            echo &#34;&#34;
            echo &#34;Check if system needs a reboot after package updates&#34;
            echo &#34;&#34;
            echo &#34;Options:&#34;
            echo &#34;  -v, --verbose    Show detailed information&#34;
            echo &#34;  -h, --help       Show this help message&#34;
            echo &#34;&#34;
            echo &#34;Exit codes:&#34;
            echo &#34;  0 - No reboot needed&#34;
            echo &#34;  1 - Reboot needed&#34;
            exit 0
            ;;
        *)
            echo &#34;Unknown option: $1&#34;
            exit 1
            ;;
    esac
done

echo -e &#34;${BLUE}=== Arch Linux Reboot Check ===${NC}\n&#34;

# Check 1: Kernel version
echo -e &#34;${BLUE}Checking kernel version...${NC}&#34;
INSTALLED_KERNEL=$(pacman -Q linux 2&gt;/dev/null | awk &#39;{print $2}&#39; || echo &#34;&#34;)
RUNNING_KERNEL=$(uname -r)

if [ -z &#34;$INSTALLED_KERNEL&#34; ]; then
    # Try linux-lts or other kernel packages
    for kernel_pkg in linux-lts linux-zen linux-hardened; do
        INSTALLED_KERNEL=$(pacman -Q &#34;$kernel_pkg&#34; 2&gt;/dev/null | awk &#39;{print $2}&#39; || echo &#34;&#34;)
        if [ -n &#34;$INSTALLED_KERNEL&#34; ]; then
            break
        fi
    done
fi

if [ -n &#34;$INSTALLED_KERNEL&#34; ]; then
    # Remove -ARCH suffix from running kernel for comparison
    RUNNING_KERNEL_CLEAN=$(echo &#34;$RUNNING_KERNEL&#34; | sed &#39;s/-ARCH$//&#39; | sed &#39;s/-lts$//&#39; | sed &#39;s/-zen$//&#39; | sed &#39;s/-hardened$//&#39;)
    INSTALLED_KERNEL_CLEAN=$(echo &#34;$INSTALLED_KERNEL&#34; | sed &#39;s/\.arch.*$//&#39;)
    
    if [ &#34;$VERBOSE&#34; -eq 1 ]; then
        echo &#34;  Installed: $INSTALLED_KERNEL&#34;
        echo &#34;  Running:   $RUNNING_KERNEL&#34;
    fi
    
    if [[ ! &#34;$RUNNING_KERNEL&#34; =~ &#34;$INSTALLED_KERNEL_CLEAN&#34; ]]; then
        echo -e &#34;  ${RED}✗ Kernel mismatch detected${NC}&#34;
        echo -e &#34;    Installed: ${YELLOW}$INSTALLED_KERNEL${NC}&#34;
        echo -e &#34;    Running:   ${YELLOW}$RUNNING_KERNEL${NC}&#34;
        REBOOT_NEEDED=1
    else
        echo -e &#34;  ${GREEN}✓ Kernel versions match${NC}&#34;
    fi
else
    echo -e &#34;  ${YELLOW}⚠ Could not determine installed kernel package${NC}&#34;
fi

echo &#34;&#34;

# Check 2: Critical system packages
echo -e &#34;${BLUE}Checking critical system packages...${NC}&#34;

CRITICAL_PACKAGES=(
    &#34;systemd&#34;
    &#34;glibc&#34;
    &#34;linux-firmware&#34;
    &#34;amd-ucode&#34;
    &#34;intel-ucode&#34;
    &#34;dbus&#34;
)

UPDATED_CRITICAL=&#34;&#34;
PACMAN_LOG=&#34;/var/log/pacman.log&#34;

if [ -f &#34;$PACMAN_LOG&#34; ]; then
    # Check packages updated in the last 24 hours
    SINCE_TIME=$(date -d &#39;24 hours ago&#39; &#39;+%Y-%m-%d %H:%M&#39; 2&gt;/dev/null || date -v-24H &#39;+%Y-%m-%d %H:%M&#39; 2&gt;/dev/null || echo &#34;&#34;)
    
    for pkg in &#34;${CRITICAL_PACKAGES[@]}&#34;; do
        # Check if package is installed
        if pacman -Q &#34;$pkg&#34; &amp;&gt;/dev/null; then
            # Check if it was recently upgraded
            if [ -n &#34;$SINCE_TIME&#34; ]; then
                RECENT_UPDATE=$(grep -E &#34;^\[$SINCE_TIME&#34; &#34;$PACMAN_LOG&#34; | grep -E &#34;upgraded $pkg &#34; | tail -n 1)
            else
                # Fallback: check last 100 lines
                RECENT_UPDATE=$(tail -n 100 &#34;$PACMAN_LOG&#34; | grep -E &#34;upgraded $pkg &#34; | tail -n 1)
            fi
            
            if [ -n &#34;$RECENT_UPDATE&#34; ]; then
                UPDATED_CRITICAL=&#34;$UPDATED_CRITICAL $pkg&#34;
                if [ &#34;$VERBOSE&#34; -eq 1 ]; then
                    echo -e &#34;  ${YELLOW}⚠ $pkg was recently updated${NC}&#34;
                fi
                REBOOT_NEEDED=1
            fi
        fi
    done
    
    if [ -n &#34;$UPDATED_CRITICAL&#34; ]; then
        echo -e &#34;  ${RED}✗ Critical packages updated:${YELLOW}$UPDATED_CRITICAL${NC}&#34;
    else
        echo -e &#34;  ${GREEN}✓ No critical package updates detected${NC}&#34;
    fi
else
    echo -e &#34;  ${YELLOW}⚠ Cannot read pacman log${NC}&#34;
fi

echo &#34;&#34;

# Check 3: Processes using deleted libraries/executables
echo -e &#34;${BLUE}Checking for processes using deleted files...${NC}&#34;

if [ &#34;$(id -u)&#34; -eq 0 ]; then
    DELETED_COUNT=0
    PROCESSES_AFFECTED=&#34;&#34;
    
    # Find processes with deleted files
    for pid in /proc/[0-9]*; do
        pid_num=$(basename &#34;$pid&#34;)
        
        # Check if process maps contain deleted files
        if [ -f &#34;$pid/maps&#34; ]; then
            deleted_libs=$(grep -E &#39;\.so.*\(deleted\)|\/usr\/bin.*\(deleted\)&#39; &#34;$pid/maps&#34; 2&gt;/dev/null | wc -l || echo &#34;0&#34;)
            
            if [ &#34;$deleted_libs&#34; -gt 0 ]; then
                DELETED_COUNT=$((DELETED_COUNT + 1))
                
                if [ &#34;$VERBOSE&#34; -eq 1 ]; then
                    proc_name=$(cat &#34;$pid/comm&#34; 2&gt;/dev/null || echo &#34;unknown&#34;)
                    echo -e &#34;  ${YELLOW}⚠ PID $pid_num ($proc_name) using deleted files${NC}&#34;
                fi
            fi
        fi
    done
    
    if [ &#34;$DELETED_COUNT&#34; -gt 0 ]; then
        echo -e &#34;  ${YELLOW}⚠ Found $DELETED_COUNT processes using deleted/updated files${NC}&#34;
        echo -e &#34;  ${YELLOW}  Consider restarting services or rebooting${NC}&#34;
    else
        echo -e &#34;  ${GREEN}✓ No processes using deleted files${NC}&#34;
    fi
else
    echo -e &#34;  ${YELLOW}⚠ Run as root to check for processes using deleted files${NC}&#34;
    if [ &#34;$VERBOSE&#34; -eq 1 ]; then
        echo &#34;     (sudo $0)&#34;
    fi
fi

echo &#34;&#34;

# Final verdict
echo -e &#34;${BLUE}=== Summary ===${NC}&#34;
if [ &#34;$REBOOT_NEEDED&#34; -eq 1 ]; then
    echo -e &#34;${RED}✗ Reboot is recommended${NC}&#34;
    echo &#34;&#34;
    echo &#34;Run &#39;systemctl reboot&#39; or &#39;reboot&#39; to restart the system&#34;
    exit 1
else
    echo -e &#34;${GREEN}✓ No reboot needed${NC}&#34;
    exit 0
fi
</code></pre></div></div><script src=/assets/shared-nav.js></script></body></html>