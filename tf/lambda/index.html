<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Lambda // rowstu.net</title><link rel=stylesheet href=/assets/shared-theme.css><style>.markdown-content{max-width:900px;margin:0 auto;line-height:1.7}.markdown-content h1{font-size:2.5rem;margin-bottom:1rem;color:var(--accent-teal);border-bottom:2px solid var(--border);padding-bottom:.5rem}.markdown-content h2{font-size:2rem;margin-top:2rem;margin-bottom:1rem;color:var(--accent-orange)}.markdown-content h3{font-size:1.5rem;margin-top:1.5rem;margin-bottom:.75rem;color:var(--text-primary)}.markdown-content p{margin-bottom:1rem}.markdown-content code{background:var(--bg-light);padding:.2rem .4rem;border-radius:3px;font-family:jetbrains mono,monospace;font-size:.9em}.markdown-content pre{background:var(--bg-light);padding:1rem;border-radius:6px;overflow-x:auto;margin-bottom:1rem}.markdown-content pre code{background:0 0;padding:0}.markdown-content a{color:var(--accent-teal);text-decoration:none}.markdown-content a:hover{text-decoration:underline}.markdown-content ul,.markdown-content ol{margin-bottom:1rem;padding-left:2rem}.markdown-content li{margin-bottom:.5rem}.markdown-content blockquote{border-left:4px solid var(--accent-teal);padding-left:1rem;margin:1rem 0;color:var(--text-secondary);font-style:italic}.markdown-content table{width:100%;border-collapse:collapse;margin-bottom:1rem}.markdown-content th,.markdown-content td{border:1px solid var(--border);padding:.75rem;text-align:left}.markdown-content th{background:var(--bg-light);font-weight:600}.breadcrumb{padding:1rem 0;color:var(--text-secondary);font-size:.95rem}.breadcrumb a{color:var(--accent-teal);text-decoration:none}.breadcrumb a:hover{text-decoration:underline}</style></head><body><div class=app-header><h1 class=app-title>Lambda</h1></div><div class=container><div class=breadcrumb><a href=/>Home</a> / <a href=/browse/>Browse</a>/ <a href=/tflambda/>Tflambda</a></div><div class="card markdown-content"><h1 id=lambda-functions>Lambda Functions</h1><p>Deploying serverless functions with Terraform.</p><h2 id=basic-lambda-function>Basic Lambda Function</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  filename         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda.zip&#34;</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my-function&#34;</span>
</span></span><span style=display:flex><span>  role             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  handler          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.handler&#34;</span>
</span></span><span style=display:flex><span>  runtime          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python3.12&#34;</span>
</span></span><span style=display:flex><span>  source_code_hash <span style=color:#f92672>=</span> <span style=color:#66d9ef>filebase64sha256</span>(<span style=color:#e6db74>&#34;lambda.zip&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  timeout     <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>  memory_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>environment</span> {
</span></span><span style=display:flex><span>    variables <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      ENV <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  tags <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    Name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my-function&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=iam-role-for-lambda>IAM Role for Lambda</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role&#34; &#34;lambda&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-execution-role&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  assume_role_policy <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>({
</span></span><span style=display:flex><span>    Version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>    Statement <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        Action <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>        Effect <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        Principal <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>          Service <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda.amazonaws.com&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Basic execution role (CloudWatch Logs)
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy_attachment&#34; &#34;lambda_basic&#34;</span> {
</span></span><span style=display:flex><span>  role       <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  policy_arn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># VPC access (if deploying in VPC)
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy_attachment&#34; &#34;lambda_vpc&#34;</span> {
</span></span><span style=display:flex><span>  role       <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  policy_arn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lambda-with-inline-code>Lambda with Inline Code</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;archive_file&#34; &#34;lambda&#34;</span> {
</span></span><span style=display:flex><span>  type        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;zip&#34;</span>
</span></span><span style=display:flex><span>  output_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${path.module}/lambda.zip&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>source</span> {
</span></span><span style=display:flex><span>    content  <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&lt;&lt;-</span><span style=color:#66d9ef>EOF</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>import</span> <span style=color:#66d9ef>json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>def</span> <span style=color:#66d9ef>handler</span>(<span style=color:#66d9ef>event</span>, <span style=color:#66d9ef>context</span>)<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>print</span>(<span style=color:#66d9ef>f</span><span style=color:#e6db74>&#34;Received event: {json.dumps(event)}&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>              <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>statusCode</span><span style=color:#960050;background-color:#1e0010>&#39;:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>              <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>body</span><span style=color:#960050;background-color:#1e0010>&#39;:</span> <span style=color:#66d9ef>json</span>.<span style=color:#66d9ef>dumps</span>({<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>message</span><span style=color:#960050;background-color:#1e0010>&#39;:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>Hello</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>Lambda</span><span style=color:#960050;background-color:#1e0010>!&#39;</span>})
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>EOF</span>
</span></span><span style=display:flex><span>    filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.py&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function&#34; &#34;inline&#34;</span> {
</span></span><span style=display:flex><span>  filename         <span style=color:#f92672>=</span> <span style=color:#66d9ef>data</span>.<span style=color:#66d9ef>archive_file</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>output_path</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;inline-function&#34;</span>
</span></span><span style=display:flex><span>  role             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  handler          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.handler&#34;</span>
</span></span><span style=display:flex><span>  runtime          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python3.12&#34;</span>
</span></span><span style=display:flex><span>  source_code_hash <span style=color:#f92672>=</span> <span style=color:#66d9ef>data</span>.<span style=color:#66d9ef>archive_file</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>output_base64sha256</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lambda-from-s3>Lambda from S3</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function&#34; &#34;from_s3&#34;</span> {
</span></span><span style=display:flex><span>  s3_bucket        <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_s3_bucket</span>.<span style=color:#66d9ef>lambda_code</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  s3_key           <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda/my-function.zip&#34;</span>
</span></span><span style=display:flex><span>  s3_object_version <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_s3_object</span>.<span style=color:#66d9ef>lambda_code</span>.<span style=color:#66d9ef>version_id</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;s3-function&#34;</span>
</span></span><span style=display:flex><span>  role             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  handler          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.handler&#34;</span>
</span></span><span style=display:flex><span>  runtime          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python3.12&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lambda-in-vpc>Lambda in VPC</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function&#34; &#34;vpc&#34;</span> {
</span></span><span style=display:flex><span>  filename         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda.zip&#34;</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;vpc-function&#34;</span>
</span></span><span style=display:flex><span>  role             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  handler          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.handler&#34;</span>
</span></span><span style=display:flex><span>  runtime          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python3.12&#34;</span>
</span></span><span style=display:flex><span>  source_code_hash <span style=color:#f92672>=</span> <span style=color:#66d9ef>filebase64sha256</span>(<span style=color:#e6db74>&#34;lambda.zip&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>vpc_config</span> {
</span></span><span style=display:flex><span>    subnet_ids         <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_subnet</span>.<span style=color:#66d9ef>private</span>[<span style=color:#960050;background-color:#1e0010>*</span>].<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>    security_group_ids <span style=color:#f92672>=</span> [<span style=color:#66d9ef>aws_security_group</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>id</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34; &#34;lambda&#34;</span> {
</span></span><span style=display:flex><span>  name        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-sg&#34;</span>
</span></span><span style=display:flex><span>  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Security group for Lambda function&#34;</span>
</span></span><span style=display:flex><span>  vpc_id      <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_vpc</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>egress</span> {
</span></span><span style=display:flex><span>    from_port   <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    to_port     <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    protocol    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>    cidr_blocks <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  tags <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    Name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-sg&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lambda-with-layers>Lambda with Layers</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_layer_version&#34; &#34;dependencies&#34;</span> {
</span></span><span style=display:flex><span>  filename            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;layer.zip&#34;</span>
</span></span><span style=display:flex><span>  layer_name          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python-dependencies&#34;</span>
</span></span><span style=display:flex><span>  compatible_runtimes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;python3.12&#34;</span>]
</span></span><span style=display:flex><span>  description         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Common Python dependencies&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function&#34; &#34;with_layer&#34;</span> {
</span></span><span style=display:flex><span>  filename         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda.zip&#34;</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;layered-function&#34;</span>
</span></span><span style=display:flex><span>  role             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  handler          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.handler&#34;</span>
</span></span><span style=display:flex><span>  runtime          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python3.12&#34;</span>
</span></span><span style=display:flex><span>  source_code_hash <span style=color:#f92672>=</span> <span style=color:#66d9ef>filebase64sha256</span>(<span style=color:#e6db74>&#34;lambda.zip&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  layers <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>aws_lambda_layer_version</span>.<span style=color:#66d9ef>dependencies</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=api-gateway-trigger>API Gateway Trigger</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_apigatewayv2_api&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  name          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-api&#34;</span>
</span></span><span style=display:flex><span>  protocol_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;HTTP&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_apigatewayv2_stage&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  api_id      <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_apigatewayv2_api</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  name        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;$default&#34;</span>
</span></span><span style=display:flex><span>  auto_deploy <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_apigatewayv2_integration&#34; &#34;lambda&#34;</span> {
</span></span><span style=display:flex><span>  api_id             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_apigatewayv2_api</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  integration_type   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AWS_PROXY&#34;</span>
</span></span><span style=display:flex><span>  integration_uri    <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>invoke_arn</span>
</span></span><span style=display:flex><span>  integration_method <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;POST&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_apigatewayv2_route&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  api_id    <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_apigatewayv2_api</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  route_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;GET /hello&#34;</span>
</span></span><span style=display:flex><span>  target    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;integrations/${aws_apigatewayv2_integration.lambda.id}&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_permission&#34; &#34;api_gateway&#34;</span> {
</span></span><span style=display:flex><span>  statement_id  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowAPIGateway&#34;</span>
</span></span><span style=display:flex><span>  action        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda:InvokeFunction&#34;</span>
</span></span><span style=display:flex><span>  function_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>  principal     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;apigateway.amazonaws.com&#34;</span>
</span></span><span style=display:flex><span>  source_arn    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${aws_apigatewayv2_api.main.execution_arn}/*/*&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=s3-trigger>S3 Trigger</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_permission&#34; &#34;s3&#34;</span> {
</span></span><span style=display:flex><span>  statement_id  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowS3Invoke&#34;</span>
</span></span><span style=display:flex><span>  action        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda:InvokeFunction&#34;</span>
</span></span><span style=display:flex><span>  function_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>  principal     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;s3.amazonaws.com&#34;</span>
</span></span><span style=display:flex><span>  source_arn    <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_s3_bucket</span>.<span style=color:#66d9ef>trigger</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_s3_bucket_notification&#34; &#34;lambda&#34;</span> {
</span></span><span style=display:flex><span>  bucket <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_s3_bucket</span>.<span style=color:#66d9ef>trigger</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>lambda_function</span> {
</span></span><span style=display:flex><span>    lambda_function_arn <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>    events              <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;s3:ObjectCreated:*&#34;</span>]
</span></span><span style=display:flex><span>    filter_prefix       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;uploads/&#34;</span>
</span></span><span style=display:flex><span>    filter_suffix       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;.json&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  depends_on <span style=color:#f92672>=</span> [<span style=color:#66d9ef>aws_lambda_permission</span>.<span style=color:#66d9ef>s3</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=cloudwatch-events--eventbridge-trigger>CloudWatch Events / EventBridge Trigger</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_cloudwatch_event_rule&#34; &#34;schedule&#34;</span> {
</span></span><span style=display:flex><span>  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-schedule&#34;</span>
</span></span><span style=display:flex><span>  description         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Run Lambda every 5 minutes&#34;</span>
</span></span><span style=display:flex><span>  schedule_expression <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;rate(5 minutes)&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_cloudwatch_event_target&#34; &#34;lambda&#34;</span> {
</span></span><span style=display:flex><span>  rule      <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_cloudwatch_event_rule</span>.<span style=color:#66d9ef>schedule</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  target_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda&#34;</span>
</span></span><span style=display:flex><span>  arn       <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_permission&#34; &#34;eventbridge&#34;</span> {
</span></span><span style=display:flex><span>  statement_id  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowEventBridge&#34;</span>
</span></span><span style=display:flex><span>  action        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda:InvokeFunction&#34;</span>
</span></span><span style=display:flex><span>  function_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>  principal     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;events.amazonaws.com&#34;</span>
</span></span><span style=display:flex><span>  source_arn    <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_cloudwatch_event_rule</span>.<span style=color:#66d9ef>schedule</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=sqs-trigger>SQS Trigger</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_sqs_queue&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-trigger-queue&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_event_source_mapping&#34; &#34;sqs&#34;</span> {
</span></span><span style=display:flex><span>  event_source_arn <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_sqs_queue</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  batch_size       <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  enabled          <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># IAM policy for SQS access
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy&#34; &#34;lambda_sqs&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-sqs-policy&#34;</span>
</span></span><span style=display:flex><span>  role <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  policy <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>({
</span></span><span style=display:flex><span>    Version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>    Statement <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        Effect <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        Action <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;sqs:ReceiveMessage&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;sqs:DeleteMessage&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;sqs:GetQueueAttributes&#34;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>        Resource <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_sqs_queue</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lambda-with-dead-letter-queue>Lambda with Dead Letter Queue</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_sqs_queue&#34; &#34;dlq&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda-dlq&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function&#34; &#34;with_dlq&#34;</span> {
</span></span><span style=display:flex><span>  filename         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lambda.zip&#34;</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;function-with-dlq&#34;</span>
</span></span><span style=display:flex><span>  role             <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>lambda</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  handler          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.handler&#34;</span>
</span></span><span style=display:flex><span>  runtime          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;python3.12&#34;</span>
</span></span><span style=display:flex><span>  source_code_hash <span style=color:#f92672>=</span> <span style=color:#66d9ef>filebase64sha256</span>(<span style=color:#e6db74>&#34;lambda.zip&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>dead_letter_config</span> {
</span></span><span style=display:flex><span>    target_arn <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_sqs_queue</span>.<span style=color:#66d9ef>dlq</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=function-url-no-api-gateway-needed>Function URL (No API Gateway needed)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_function_url&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  function_name      <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>  authorization_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;NONE&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>cors</span> {
</span></span><span style=display:flex><span>    allow_origins     <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;https://example.com&#34;</span>]
</span></span><span style=display:flex><span>    allow_methods     <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;GET&#34;, &#34;POST&#34;</span>]
</span></span><span style=display:flex><span>    allow_headers     <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;Content-Type&#34;</span>]
</span></span><span style=display:flex><span>    max_age           <span style=color:#f92672>=</span> <span style=color:#ae81ff>86400</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;function_url&#34;</span> {
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function_url</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_url</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=provisioned-concurrency>Provisioned Concurrency</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_alias&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  name             <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>  function_name    <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>  function_version <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>version</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_lambda_provisioned_concurrency_config&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  function_name                     <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>  provisioned_concurrent_executions <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  qualifier                         <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_alias</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=outputs>Outputs</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;function_name&#34;</span> {
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>function_name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;function_arn&#34;</span> {
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>arn</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;invoke_arn&#34;</span> {
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_lambda_function</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>invoke_arn</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;api_endpoint&#34;</span> {
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_apigatewayv2_api</span>.<span style=color:#66d9ef>main</span>.<span style=color:#66d9ef>api_endpoint</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><script src=/assets/shared-nav.js></script></body></html>