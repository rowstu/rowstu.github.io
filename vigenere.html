<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vigenere Cipher</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg: #1a1d23;
			--surface: #252932;
			--surface-hover: #2d323d;
			--border: #3d4351;
			--text: #e4e7eb;
			--text-muted: #9ca3af;
			--accent: #10b981;
			--accent-alt: #8b5cf6;
			--warning: #f59e0b;
			--danger: #ef4444;
		}

		* { margin: 0; padding: 0; box-sizing: border-box; }

		body {
			font-family: 'IBM Plex Mono', monospace;
			background: var(--bg);
			color: var(--text);
			min-height: 100vh;
			padding: 1.5rem;
		}

		.container { max-width: 900px; margin: 0 auto; }

		header { margin-bottom: 1.5rem; }

		h1 {
			font-size: 1.5rem;
			font-weight: 600;
			color: var(--accent);
			margin-bottom: 0.5rem;
		}

		.subtitle { color: var(--text-muted); font-size: 0.875rem; }

		.panel {
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 6px;
			margin-bottom: 1rem;
			overflow: hidden;
		}

		.panel-header {
			padding: 0.75rem 1rem;
			border-bottom: 1px solid var(--border);
			font-size: 0.8rem;
			color: var(--text-muted);
		}

		.panel-header .label { font-weight: 500; color: var(--text); }

		.panel-content { padding: 1rem; }

		.mode-toggle {
			display: flex;
			gap: 0.5rem;
			margin-bottom: 1rem;
		}

		.mode-btn {
			flex: 1;
			padding: 0.75rem 1rem;
			background: var(--surface-hover);
			border: 2px solid var(--border);
			border-radius: 6px;
			color: var(--text-muted);
			font-family: inherit;
			font-size: 0.85rem;
			cursor: pointer;
			transition: all 0.2s;
		}

		.mode-btn:hover { border-color: var(--accent); }

		.mode-btn.active {
			background: var(--accent);
			border-color: var(--accent);
			color: #000;
		}

		.key-input {
			margin-bottom: 1rem;
		}

		.key-input label {
			display: block;
			margin-bottom: 0.5rem;
			font-size: 0.85rem;
			color: var(--text-muted);
		}

		.key-wrapper {
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		input[type="text"] {
			flex: 1;
			padding: 0.75rem 1rem;
			background: var(--surface-hover);
			border: 2px solid var(--border);
			border-radius: 6px;
			color: var(--accent-alt);
			font-family: inherit;
			font-size: 1.1rem;
			font-weight: 600;
			letter-spacing: 0.1em;
			text-transform: uppercase;
			outline: none;
			transition: border-color 0.2s;
		}

		input[type="text"]:focus { border-color: var(--accent-alt); }
		input[type="text"]::placeholder { color: var(--text-muted); text-transform: none; letter-spacing: normal; font-weight: 400; }

		.key-length {
			font-size: 0.8rem;
			color: var(--text-muted);
			min-width: 80px;
		}

		textarea {
			width: 100%;
			height: 120px;
			padding: 1rem;
			background: var(--surface-hover);
			border: 1px solid var(--border);
			border-radius: 6px;
			color: var(--text);
			font-family: inherit;
			font-size: 0.9rem;
			line-height: 1.6;
			resize: vertical;
			outline: none;
			margin-bottom: 1rem;
		}

		textarea:focus { border-color: var(--accent); }
		textarea::placeholder { color: var(--text-muted); }

		.output-area {
			background: var(--bg);
			border-radius: 6px;
			padding: 1rem;
			min-height: 120px;
			font-size: 0.9rem;
			line-height: 1.6;
			white-space: pre-wrap;
			word-break: break-word;
		}

		.error {
			color: var(--danger);
			font-size: 0.85rem;
			padding: 0.5rem;
			display: none;
		}

		.error.visible { display: block; }

		.toolbar {
			display: flex;
			gap: 0.5rem;
			margin-bottom: 1rem;
		}

		button {
			padding: 0.5rem 1rem;
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: 4px;
			color: var(--text);
			font-family: inherit;
			font-size: 0.8rem;
			cursor: pointer;
			transition: all 0.2s;
		}

		button:hover {
			background: var(--surface-hover);
			border-color: var(--accent);
		}

		.tabula-container {
			overflow-x: auto;
		}

		.tabula-recta {
			font-size: 0.6rem;
			border-collapse: collapse;
		}

		.tabula-recta th, .tabula-recta td {
			width: 22px;
			height: 22px;
			text-align: center;
			border: 1px solid var(--border);
		}

		.tabula-recta th {
			background: var(--surface-hover);
			color: var(--accent);
			font-weight: 600;
		}

		.tabula-recta td {
			color: var(--text-muted);
		}

		.tabula-recta td.highlight {
			background: var(--accent);
			color: #000;
			font-weight: 600;
		}

		.tabula-recta tr:first-child th {
			color: var(--accent-alt);
		}

		.how-it-works {
			font-size: 0.85rem;
			line-height: 1.8;
			color: var(--text-muted);
		}

		.how-it-works strong { color: var(--text); }
		.how-it-works code {
			background: var(--surface-hover);
			padding: 0.1rem 0.3rem;
			border-radius: 3px;
			color: var(--accent);
		}

		.back-link {
			display: inline-block;
			margin-top: 1rem;
			color: var(--text-muted);
			text-decoration: none;
			font-size: 0.875rem;
		}

		.back-link:hover { color: var(--accent); }
	</style>
</head>
<body>
	<div class="container">
		<header>
			<h1>Vigenere Cipher</h1>
			<p class="subtitle">Polyalphabetic substitution cipher with keyword</p>
		</header>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Cipher Tool</span>
			</div>
			<div class="panel-content">
				<div class="mode-toggle">
					<button class="mode-btn active" id="encryptBtn" onclick="setMode('encrypt')">Encrypt</button>
					<button class="mode-btn" id="decryptBtn" onclick="setMode('decrypt')">Decrypt</button>
				</div>

				<div class="key-input">
					<label for="key">Keyword</label>
					<div class="key-wrapper">
						<input type="text" id="key" placeholder="Enter keyword (letters only)">
						<span class="key-length" id="keyLength">Length: 0</span>
					</div>
				</div>

				<textarea id="input" placeholder="Enter text to encrypt or decrypt..."></textarea>

				<div class="error" id="error"></div>

				<div class="toolbar">
					<button onclick="copyOutput()">Copy Result</button>
					<button onclick="swapIO()">Swap Input/Output</button>
					<button onclick="clearAll()">Clear</button>
				</div>

				<div class="output-area" id="output">Result will appear here...</div>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">Tabula Recta (Vigenere Square)</span>
			</div>
			<div class="panel-content">
				<div class="tabula-container">
					<table class="tabula-recta" id="tabulaRecta"></table>
				</div>
			</div>
		</div>

		<div class="panel">
			<div class="panel-header">
				<span class="label">How It Works</span>
			</div>
			<div class="panel-content">
				<div class="how-it-works">
					<p><strong>Encryption:</strong> For each letter in the plaintext, find the row starting with the key letter (repeated as needed), then find the column with the plaintext letter. The intersection is the ciphertext letter.</p>
					<p style="margin-top: 0.5rem;"><strong>Decryption:</strong> For each letter in the ciphertext, find the row starting with the key letter. Move along that row to find the ciphertext letter - the column header is the plaintext letter.</p>
					<p style="margin-top: 0.5rem;"><strong>Example:</strong> Encrypting <code>HELLO</code> with key <code>KEY</code>:</p>
					<p style="margin-left: 1rem;">H + K = R, E + E = I, L + Y = J, L + K = V, O + E = S</p>
					<p style="margin-left: 1rem;">Result: <code>RIJVS</code></p>
				</div>
			</div>
		</div>

		<a href="/" class="back-link">&larr; Back to home</a>
	</div>

	<script>
		const input = document.getElementById('input');
		const output = document.getElementById('output');
		const keyInput = document.getElementById('key');
		const keyLength = document.getElementById('keyLength');
		const error = document.getElementById('error');
		const tabulaRecta = document.getElementById('tabulaRecta');

		let mode = 'encrypt';

		function setMode(newMode) {
			mode = newMode;
			document.getElementById('encryptBtn').classList.toggle('active', mode === 'encrypt');
			document.getElementById('decryptBtn').classList.toggle('active', mode === 'decrypt');
			process();
		}

		function vigenere(text, key, encrypt = true) {
			if (!key) return text;

			key = key.toLowerCase().replace(/[^a-z]/g, '');
			if (!key) return text;

			let result = '';
			let keyIndex = 0;

			for (let i = 0; i < text.length; i++) {
				const char = text[i];
				const isUpper = char >= 'A' && char <= 'Z';
				const isLower = char >= 'a' && char <= 'z';

				if (isUpper || isLower) {
					const base = isUpper ? 65 : 97;
					const charCode = char.charCodeAt(0) - base;
					const shift = key[keyIndex % key.length].charCodeAt(0) - 97;

					let newCode;
					if (encrypt) {
						newCode = (charCode + shift) % 26;
					} else {
						newCode = (charCode - shift + 26) % 26;
					}

					result += String.fromCharCode(newCode + base);
					keyIndex++;
				} else {
					result += char;
				}
			}

			return result;
		}

		function process() {
			error.classList.remove('visible');

			const text = input.value;
			const key = keyInput.value.replace(/[^a-zA-Z]/g, '');

			keyLength.textContent = `Length: ${key.length}`;

			if (!text) {
				output.textContent = 'Result will appear here...';
				return;
			}

			if (!key) {
				error.textContent = 'Please enter a keyword (letters only)';
				error.classList.add('visible');
				output.textContent = text;
				return;
			}

			const result = vigenere(text, key, mode === 'encrypt');
			output.textContent = result;

			highlightTabula(key);
		}

		function buildTabulaRecta() {
			const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
			let html = '<tr><th></th>';

			// Header row
			for (let c of alphabet) {
				html += `<th>${c}</th>`;
			}
			html += '</tr>';

			// Data rows
			for (let i = 0; i < 26; i++) {
				html += `<tr><th>${alphabet[i]}</th>`;
				for (let j = 0; j < 26; j++) {
					const char = alphabet[(i + j) % 26];
					html += `<td data-row="${i}" data-col="${j}">${char}</td>`;
				}
				html += '</tr>';
			}

			tabulaRecta.innerHTML = html;
		}

		function highlightTabula(key) {
			// Clear highlights
			document.querySelectorAll('.tabula-recta td').forEach(td => {
				td.classList.remove('highlight');
			});

			if (!key) return;

			// Highlight rows used by key
			key = key.toLowerCase().replace(/[^a-z]/g, '');
			const uniqueKeys = [...new Set(key.split(''))];

			uniqueKeys.forEach(k => {
				const row = k.charCodeAt(0) - 97;
				document.querySelectorAll(`.tabula-recta td[data-row="${row}"]`).forEach(td => {
					td.classList.add('highlight');
				});
			});
		}

		function copyOutput() {
			navigator.clipboard.writeText(output.textContent).then(() => {
				const btn = event.target;
				const orig = btn.textContent;
				btn.textContent = 'Copied!';
				setTimeout(() => btn.textContent = orig, 1500);
			});
		}

		function swapIO() {
			input.value = output.textContent;
			process();
		}

		function clearAll() {
			input.value = '';
			keyInput.value = '';
			output.textContent = 'Result will appear here...';
			error.classList.remove('visible');
			keyLength.textContent = 'Length: 0';
			highlightTabula('');
		}

		// Event listeners
		input.addEventListener('input', process);
		keyInput.addEventListener('input', () => {
			keyInput.value = keyInput.value.replace(/[^a-zA-Z]/g, '');
			process();
		});

		// Initialize
		buildTabulaRecta();
	</script>
</body>
</html>
